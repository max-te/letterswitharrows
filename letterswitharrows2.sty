%% letterswitharrows2.sty
%% Copyright 2019 J. Maximilian Teegen
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
% http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
% This work has the LPPL maintenance status “maintained”.
%
% The Current Maintainer of this work is J. M. Teegen.
%
% This work consists of the file letterswitharrows2.sty.
%

%% BASIC USAGE
%
% This package provides the math-mode command \v<letter> and
% \<letter>v where <letter> is any lower-case letter or one of a few
% select upper-case letters. The former outputs <letter> with a
% rightwards arrow above it, while the latter puts a leftwards arrow.
% Since the case of the letter v is ambiguous the corresponding
% commands are \vleft and \vright.
% These commands have been painstakingly tweaked to position the arrow
% in an aesthetically pleasing position.
%
% Primes (') and subscripts following one of these commands are
% automatically incorporated.
%
%% ADVANCED USAGE
%
% The command \rarw{<xoffset>}{<yoffset>}{<factor>}{<math>} (and its
% sibling \larw) sets a right (left) arrow over <math>. The arrow is
% offset by the lengths <xoffset> and <yoffset>. The length of the arrow
% is based on the width of <math> scaled by the factor <factor>.
%
% This command automatically incorporates subscripts into <math>
% without changing the length of the arrow. Primes (') are
% incorporated by placing a \prime near the right end of the arrow.
%
% The core functionality is provided by the command
% \jmt@arw{<xoffset>}{<yoffset>}{<factor>}{<math>}{<arrowfill>}
% where the meaning of the arguments is as above and <arrowfill> is
% assumed to be a math command which fills the horizontal space made
% available to it.
%
\NeedsTeXFormat{LaTeX2e}
\RequirePackage{expl3,xparse}
\ProvidesExplPackage
 {letterswitharrows2}
 {2019/04/04}
 {2.0.2a}
 {A package for math letters with arrows over them.}

\newcommand{\jmt@arrowfill@}[4]{%
   \m@th$#4#1\cleaders\hbox{\m@th$#4#2$}\hfill#3$%
}
\def\rarw@fill{\jmt@arrowfill@%
    {\relbar\joinrel}%
    {\joinrel\relbar\joinrel}%
    {\joinrel\rightarrow}%
    {\scriptscriptstyle}%
}
\def\rarwprime@fill{\jmt@arrowfill@%
    {\relbar\joinrel}%
    {\joinrel\relbar\joinrel}%
    {\joinrel\rightarrow\llap{\raisebox{-.8\height}[0pt][0pt]{\m@th$\scriptscriptstyle\prime$}}}%
    {\scriptscriptstyle}%
}
\def\larw@fill{\jmt@arrowfill@%
    {\leftarrow\joinrel}%
    {\joinrel\relbar\joinrel}%
    {\joinrel\relbar}%
    {\scriptscriptstyle}%
}
\def\larwprime@fill{\jmt@arrowfill@%
    {\leftarrow\joinrel}%
    {\joinrel\relbar\joinrel}%
    {\joinrel\relbar\rlap{\raisebox{-.8\height}[0pt][0pt]{\m@th$\scriptscriptstyle\prime$}}}%
    {\scriptscriptstyle}%
}

\def\gen_underscore{\char_generate:nn {95}{8}}
\cs_new_protected:Npn \rarw {
  \c_group_begin_token
  \jmt__rarw:w
}
\exp_args:NNx \NewDocumentCommand \jmt__rarw:w {m m m m t' e{\gen_underscore} t'} {
  \jmt@arw{#1}{#2}{#3} {
    #4
    \exp_args:Nf\IfValueT{\use:n#6} {
      \c_math_subscript_token
      {
        \rlap{\m@th$\mskip-1mu\scriptscriptstyle #6$}
      }
    }
  }{
    \bool_lazy_or:nnTF{#5}{#7}{\rarwprime@fill}{\rarw@fill}
  }
  \exp_args:Nf\IfValueTF{\use:n#6}{
    \hphantom{\mskip-1mu\scriptscriptstyle #6}
  }{
    \mkern2.5mu
  }
  \c_group_end_token
}
\cs_new_protected:Npn \larw {
  \c_group_begin_token
  \jmt__larw:w
}
\exp_args:NNx \NewDocumentCommand \jmt__larw:w {m m m m t' e{\gen_underscore} t'} {
  \mkern.5mu
  \jmt@arw{#1}{#2}{#3} {
    #4
    \exp_args:Nf\IfValueT{\use:n#6} {
      \c_math_subscript_token
      {
        \rlap{\m@th$\mskip-1mu\scriptscriptstyle #6$}
      }
    }
  }{
    \bool_lazy_or:nnTF{#5}{#7}{\larwprime@fill}{\larw@fill}
  }
  \exp_args:Nf\IfValueTF{\use:n#6}{
    \hphantom{\mskip-1mu\scriptscriptstyle #6}
  }{
    \mkern2.5mu
  }
  \c_group_end_token
}

\ExplSyntaxOff

\newcommand\jmt@arw[5]{\mathpalette\jmt@arw@exp{{#1}{#2}{#3}{#4}{#5}}}
\newcommand\jmt@arw@exp[2]{\jmt@arw@core{#1}#2}
\newcommand\jmt@arw@core[6]{\vbox{%
    \lineskiplimit=\maxdimen
    \baselineskip=0pt
    \lineskip=#3
    \halign{##\cr
      \hskip\glueexpr#2\relax
      \setbox0\hbox{#6}%
      \edef\hfill{\hskip-\the\wd0plus1fillminus0pt}%
      #6\relax
      \hskip\glueexpr-#2plus-1fill+0pt plus
      1000fill/\numexpr1000*\dimexpr#4pt\relax/65536\relax\relax
      \cr
      \hss\m@th$#1#5$\hss\cr
    }}}


% ---- Hyperref bookmarks replacements ---
\@ifpackageloaded{hyperref}{\pdfstringdefDisableCommands{
  \def\rarw#1#2#3#4{\ifpdfstringunicode{#1\unichar{"20D7}}{#1}} 
  \def\larw#1#2#3#4{\ifpdfstringunicode{#1\unichar{"20D6}}{#1}} 
}}{}


\def\va{\rarw{.0em}{.0ex}{1.2}{a}}
    \def\av{\larw{-.05em}{.0ex}{1.2}{a}}
\def\vb{\rarw{.1em}{.05ex}{1.2}{b}}
    \def\bv{\larw{.0em}{.05ex}{1.2}{b}}
\def\vc{\rarw{.1em}{.0ex}{1.2}{c}}
    \def\cv{\larw{-.05em}{.0ex}{1.2}{c}}
\def\vd{\rarw{.1em}{.0ex}{1.2}{d}}
    \def\dv{\larw{.05em}{.0ex}{1.2}{d}}
\def\ve{\rarw{.1em}{.0ex}{1.2}{e}}
    \def\ev{\larw{-.05em}{.0ex}{1.2}{e}}
\def\vf{\rarw{.15em}{.0ex}{1.1}{f}}
    \def\fv{\larw{.1em}{.0ex}{1.1}{f}}
\def\vg{\rarw{.1em}{.0ex}{1.2}{g}}
    \def\gv{\larw{-.05em}{.0ex}{1.4}{g}}
\def\vh{\rarw{.02em}{.02ex}{1.4}{h}}
    \def\hv{\larw{.0em}{.02ex}{1.4}{h}}
\def\vi{\rarw{.1em}{.0ex}{1.5}{i}}
    \def\iv{\larw{-.1em}{.0ex}{1.5}{i}}
\def\vj{\rarw{.05em}{.0ex}{1.5}{j}}
    \def\jv{\larw{.0em}{.0ex}{1.5}{j}}
\def\vk{\rarw{.0em}{.0ex}{1.4}{k}}
    \def\kv{\larw{-.02em}{.0ex}{1.4}{k}}
\def\vl{\rarw{.15em}{.0ex}{1.3}{\ell}}
    \def\lv{\larw{-.05em}{.0ex}{1.3}{\ell}}
\def\vm{\rarw{-.05em}{.0ex}{1.2}{m}}
    \def\mv{\larw{-.02em}{.0ex}{1.05}{m}}
\def\vn{\rarw{.0em}{.0ex}{1.2}{n}}
    \def\nv{\larw{-.02em}{.0ex}{1.0}{n}}
\def\vo{\rarw{.07em}{.0ex}{1.3}{o}}
    \def\ov{\larw{-.05em}{.0ex}{1.4}{o}}
\def\vp{\rarw{.1em}{.0ex}{1.2}{p}}
    \def\pv{\larw{-.02em}{.0ex}{1.0}{p}}
\def\vq{\rarw{.05em}{.0ex}{1.2}{q}}
    \def\qv{\larw{-.1em}{.0ex}{1.4}{q}}
\def\vr{\rarw{-.0em}{.0ex}{1.4}{r}}
  \def\rv{\larw{-.05em}{.0ex}{1.4}{r}}
\def\vs{\rarw{-.03em}{.0ex}{1.5}{s}}
  \def\sv{\larw{-.07em}{.0ex}{1.6}{s}}
\def\vt{\rarw{-.05em}{.0ex}{1.7}{t}}
  \def\tv{\larw{-.1em}{.0ex}{1.45}{t}}
\def\vu{\rarw{.02em}{.1ex}{1.2}{u}}
    \def\uv{\larw{.0em}{.1ex}{1.0}{u}}
\def\vright{\rarw{.05em}{.1ex}{1.2}{v}}
    \def\vleft{\larw{-.05em}{.1ex}{1.0}{v}}
\def\vw{\rarw{.0em}{.1ex}{1.2}{w}}
    \def\wv{\larw{-.05em}{.1ex}{1.2}{w}}
\def\vx{\rarw{.0em}{.1ex}{1.2}{x}}
    \def\xv{\larw{.0em}{.1ex}{1.2}{x}}
\def\vy{\rarw{.05em}{.05ex}{1.2}{y}}
    \def\yv{\larw{.0em}{.05ex}{1.0}{y}}
\def\vz{\rarw{.1em}{.0ex}{1.2}{z}}
    \def\zv{\larw{-.1em}{.0ex}{1.5}{z}}

\providecommand\vv{\PackageError{letterswitharrows2}{You used \@backslashchar vv.}%
                            {Did you mean \@backslashchar vleft or \@backslashchar vright?}%
                            {Use \@backslashchar vleft or \@backslashchar vright?}%%%
                            }

\def\vA{\rarw{.15em}{0ex}{1.0}{A}}
  \def\Av{\larw{.15em}{0ex}{1.0}{A}}
\def\vE{\rarw{.12em}{.0pt}{1.1}{E}}
  \def\Ev{\larw{.1em}{.0pt}{1.1}{E}}
\def\vF{\rarw{.15em}{.0pt}{1.1}{F}}
  \def\Fv{\larw{.1em}{.0pt}{1.1}{F}}
\def\vS{\rarw{.08em}{0ex}{1.2}{S}}
  \def\Sv{\larw{.0em}{0ex}{1.3}{S}}
\def\vT{\rarw{-.0em}{.0pt}{1.2}{T}}
  \def\Tv{\larw{-.0em}{.0pt}{1.2}{T}}
\def\vU{\rarw{.07em}{.0ex}{1}{U}}
  \def\Uv{\larw{-.05em}{.0ex}{1.2}{U}}
\def\vP{\rarw{.15em}{.0pt}{1}{P}}
  \def\Pv{\larw{.15em}{.0pt}{1}{P}}
\def\vN{\rarw{.12em}{.5pt}{1.0}{N}}
  \def\Nv{\larw{.1em}{.5pt}{1.0}{N}}

\def\vcdot{\rarw{-.0em}{.0ex}{2}{\cdot}}
    \def\cdotv{\larw{-.2em}{.0ex}{2}{\cdot}}
\def\vcA{\rarw{.2em}{0ex}{1.0}{\mathcal{A}}}
  \def\cAv{\larw{.15em}{0ex}{1.0}{\mathcal{A}}}

\endinput
